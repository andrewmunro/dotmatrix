#include <ESP32-HUB75-MatrixPanel-I2S-DMA.h>
#include <WiFi.h>
#include <WebSocketsServer.h>

#define PANEL_WIDTH 64
#define PANEL_HEIGHT 32  // Panel height of 64 will required PIN_E to be defined.
#define PANELS_NUMBER 2  // Number of chained panels, if just a single panel, obviously set to 1
#define PIN_E 32
#define PANE_WIDTH PANEL_WIDTH * PANELS_NUMBER
#define PANE_HEIGHT PANEL_HEIGHT

const char* ssid = "XXX";
const char* password = "XXX";

const uint16_t testData[] PROGMEM = {
  63488, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 16521, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16552, 8261, 0, 0, 0, 0, 0, 0, 0, 0, 12294, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 14504, 4130, 0, 0, 0, 0, 0, 0, 0, 0, 0, 65268, 62994, 61797, 57701, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 16521, 16553, 16553, 16553, 37842, 63422, 65535, 65535, 65535, 59164, 25069, 16553, 14504, 6179, 0, 0, 0, 0, 0, 0, 0, 8260, 16553, 16553, 25069, 59164, 63422, 37842, 16553, 16553, 54938, 65535, 65535, 59164, 25069, 16552, 6211, 0, 0, 0, 0, 0, 0, 0, 0, 0, 65236, 62509, 61829, 61829, 61797, 51524, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 18569, 16553, 16553, 16553, 46745, 55293, 55293, 55293, 55293, 55293, 55293, 53115, 27311, 16553, 12390, 6179, 10342, 16552, 16553, 16553, 16552, 12423, 8229, 16553, 16553, 33746, 53180, 53115, 27310, 16553, 38068, 55293, 55293, 55293, 46745, 16553, 14472, 4130, 0, 0, 0, 0, 0, 0, 0, 0, 0, 65236, 62056, 61829, 61829, 59749, 49444, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 16553, 16553, 16553, 40599, 45051, 45051, 31923, 16553, 16553, 29649, 44986, 45051, 40567, 16553, 16552, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16520, 16553, 16553, 31923, 45051, 40599, 16553, 16553, 36277, 45051, 40567, 16553, 16553, 16553, 12390, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 65236, 61862, 59749, 39139, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 16522, 16553, 16553, 25552, 34744, 34744, 25552, 16553, 16553, 16553, 16553, 27826, 34809, 34680, 23213, 16553, 16553, 30132, 34809, 34809, 34809, 32535, 20972, 16553, 16553, 16553, 30132, 34809, 30132, 30132, 34809, 34809, 34809, 34809, 32406, 16553, 16553, 6211, 0, 0, 0, 0, 0, 0, 0, 0, 0, 63188, 65236, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 16553, 16553, 16553, 24180, 26615, 24180, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 18924, 24341, 24567, 24567, 24567, 26615, 24567, 24341, 18923, 16553, 18924, 24341, 24567, 21681, 24180, 24567, 24567, 24567, 24567, 23987, 16553, 12423, 2049, 0, 0, 0, 0, 0, 0, 0, 0, 0, 65236, 65236, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 16553, 16553, 16875, 16148, 16373, 17584, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 15793, 16373, 16373, 17584, 16553, 17358, 16309, 16373, 15536, 16553, 17069, 16244, 16244, 17068, 16553, 17358, 16309, 16148, 16875, 16553, 16553, 10341, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 65236, 63188, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 20490, 16553, 16553, 15020, 6002, 6067, 13261, 16553, 16553, 7825, 6131, 6131, 6131, 6131, 7954, 13036, 7954, 6131, 7793, 16553, 16553, 14827, 7954, 6131, 9648, 16553, 11439, 6131, 7922, 14827, 16553, 9648, 6131, 7825, 16553, 16553, 16553, 6211, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 65236, 58930, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 12294, 16553, 16553, 12972, 1906, 1970, 11213, 16553, 12972, 1906, 2034, 2034, 2034, 2034, 5551, 12972, 1906, 2034, 9390, 16553, 16553, 14827, 3857, 2034, 5551, 16553, 5551, 2034, 5551, 16553, 16553, 3728, 2034, 9390, 16553, 14472, 6212, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 48654, 63187, 17475, 15426, 15394, 15330, 10945, 4512, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 20490, 16553, 16553, 12972, 1905, 2034, 9390, 16553, 16553, 16553, 16553, 14827, 3825, 1970, 11213, 12972, 1905, 2034, 9390, 16553, 16553, 11213, 1970, 2034, 9390, 14827, 3857, 2034, 9390, 16553, 12972, 1906, 1970, 11213, 16553, 8260, 0, 0, 0, 0, 0, 0, 0, 0, 8801, 15427, 17507, 40363, 46573, 17507, 17507, 17507, 17507, 17507, 17507, 17507, 13186, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 16553, 16553, 16553, 3728, 2034, 1970, 11213, 16553, 16553, 16553, 11213, 1970, 1906, 12972, 14827, 3857, 2034, 3728, 16553, 14827, 3857, 2034, 3857, 14827, 12972, 1906, 1906, 12972, 16553, 11213, 1970, 3857, 14827, 16552, 4131, 0, 0, 0, 0, 0, 0, 0, 15394, 17507, 17507, 15363, 52752, 34025, 17507, 17507, 17507, 17507, 32139, 19620, 17507, 17507, 17475, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 16553, 16553, 16553, 12972, 1906, 2034, 2034, 2034, 2034, 2034, 2034, 2034, 3696, 16553, 16553, 9390, 2034, 2034, 2034, 2034, 2034, 1970, 9165, 16553, 11213, 1970, 3857, 14827, 16553, 5551, 2034, 3696, 16553, 14472, 2082, 0, 0, 0, 0, 0, 0, 13250, 17507, 17507, 10883, 8452, 35820, 14757, 10819, 17507, 17507, 38383, 65535, 38383, 17507, 17507, 17507, 4416, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 12294, 16553, 16553, 16553, 14827, 3857, 2034, 2034, 2034, 2034, 3728, 16553, 16553, 16553, 16553, 16553, 9390, 2034, 2034, 2034, 1906, 12972, 16553, 16553, 5551, 2034, 5551, 16553, 16553, 3728, 2034, 9390, 16553, 12422, 2049, 0, 0, 0, 0, 0, 0, 15394, 17507, 17507, 15395, 13091, 12963, 15235, 15395, 17507, 17507, 25864, 38383, 17507, 17507, 17507, 15427, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 14407, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 14472, 14471, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 10341, 0, 0, 0, 0, 0, 0, 0, 8801, 17507, 17507, 17507, 17507, 17507, 17507, 17507, 17507, 17507, 17507, 17507, 17507, 17507, 13250, 128, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10309, 14472, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16552, 8260, 2049, 2049, 10342, 16553, 16553, 16553, 16553, 16553, 16553, 12423, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 14504, 4130, 0, 0, 0, 0, 0, 0, 0, 0, 0, 15395, 17507, 17507, 17507, 17507, 17507, 17507, 17507, 17507, 15395, 11010, 2304, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6211, 10341, 10342, 12422, 10341, 6212, 4130, 0, 0, 0, 0, 0, 8293, 16552, 16553, 16553, 16553, 16553, 16553, 14471, 12390, 8261, 6179, 4130, 4130, 6211, 6211, 6179, 2049, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6211, 12390, 12550, 10724, 8737, 6657, 2304, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6211, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 10341, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6211, 14504, 16553, 16553, 16553, 16552, 4131, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10342, 16553, 16553, 54938, 65535, 65535, 65535, 65535, 65535, 63422, 37842, 16553, 8260, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8261, 16553, 16553, 16553, 16553, 16553, 16553, 10341, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2049, 14471, 16553, 31407, 61309, 65535, 65535, 65535, 65535, 65535, 65535, 61309, 29359, 14471, 10341, 12390, 16553, 16553, 12423, 8260, 2049, 8260, 12423, 12423, 14471, 14472, 16553, 16553, 16553, 16553, 16553, 37842, 31407, 16553, 14472, 12390, 8260, 2049, 8260, 10342, 12390, 12390, 10342, 4130, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6211, 16552, 16553, 37842, 63422, 63422, 37842, 16553, 16553, 37842, 63422, 63422, 37842, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 14504, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 50616, 59164, 25069, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 14472, 4130, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 12422, 16553, 16553, 50616, 65535, 61309, 31407, 16553, 16553, 37842, 63422, 63422, 37842, 16553, 37842, 63422, 65535, 65535, 63422, 37842, 16553, 16553, 31407, 61309, 61309, 44213, 63422, 63422, 61309, 65535, 65535, 65535, 61309, 54874, 65535, 50616, 16553, 16553, 16553, 54938, 65535, 54938, 16553, 16553, 8260, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4098, 16552, 16553, 16553, 50810, 59390, 50810, 16553, 16553, 25069, 55067, 59390, 55035, 25069, 40116, 59390, 59390, 59390, 59390, 59390, 57212, 29359, 16553, 35794, 59325, 57212, 59325, 59390, 52955, 57212, 59390, 59390, 59390, 55067, 44342, 59390, 50810, 16553, 16553, 35794, 59325, 57212, 29359, 16553, 16552, 6179, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10309, 16553, 16553, 27310, 46971, 49148, 49148, 49148, 49148, 49148, 49148, 49148, 36019, 23020, 46873, 49148, 44696, 16553, 31697, 49083, 49083, 31697, 16553, 40374, 49148, 49148, 36019, 16553, 16553, 23020, 46873, 49083, 31697, 16553, 31697, 49083, 46873, 23020, 16553, 44696, 49148, 40374, 16553, 16553, 10342, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 16553, 16553, 16553, 27600, 38841, 40954, 38906, 40954, 40954, 40954, 38841, 27600, 16553, 16553, 16553, 16553, 16553, 16553, 23214, 38777, 38841, 27600, 16553, 36503, 40954, 34229, 16553, 16553, 16553, 23214, 38777, 38777, 23214, 16553, 23214, 38777, 36632, 20972, 27600, 38841, 38841, 27600, 16553, 14472, 4130, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 16553, 16553, 16553, 23729, 30712, 28535, 21165, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 18924, 28438, 30712, 30712, 30712, 30712, 28438, 18924, 18924, 28438, 30647, 23504, 16553, 16553, 16553, 23729, 30712, 28277, 16553, 16553, 18924, 28438, 28535, 21165, 28309, 30712, 28309, 16553, 16553, 8260, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 16553, 16553, 16553, 20116, 20470, 20116, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 19890, 20470, 20341, 19117, 16553, 20083, 20470, 20083, 16553, 19407, 20406, 20341, 19117, 16553, 14504, 16553, 19890, 20470, 19890, 16553, 16553, 16553, 20116, 20406, 19793, 20406, 20406, 19407, 16553, 12423, 2049, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 16392, 16553, 16553, 16875, 12051, 10228, 13745, 16553, 16553, 16553, 16553, 12423, 16552, 16875, 12051, 10228, 13745, 16553, 15310, 10164, 10228, 13745, 16553, 13487, 10228, 11922, 16553, 16552, 16552, 16875, 12051, 10228, 13487, 16553, 16553, 16553, 13745, 10228, 12083, 10228, 11922, 16553, 16553, 6211, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 18537, 16553, 16553, 11213, 1970, 2034, 9390, 16553, 8261, 0, 0, 2081, 14472, 16553, 3728, 2034, 2034, 2034, 2034, 2034, 2034, 9390, 16553, 3696, 2034, 5551, 16553, 14472, 16553, 12972, 1906, 2034, 2034, 3857, 14827, 16553, 5551, 2034, 2034, 1970, 11213, 16553, 10342, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 18601, 16553, 16553, 9390, 2034, 1906, 12972, 16553, 6179, 0, 0, 1, 12390, 16553, 12972, 1906, 2034, 2034, 5616, 3857, 2034, 9390, 14827, 3857, 1970, 11213, 16553, 12423, 14504, 16553, 5551, 2034, 2034, 3696, 16553, 16553, 9390, 2034, 2034, 3857, 14827, 16552, 4131, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 16521, 16553, 16553, 16553, 16553, 16553, 16553, 14472, 4130, 0, 0, 0, 6211, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 10309, 12390, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 3728, 2034, 2034, 9390, 16553, 10341, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 20490, 16553, 16553, 16553, 16553, 16553, 16553, 10342, 0, 0, 0, 0, 0, 8260, 16552, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 16553, 14472, 4098, 2049, 12423, 16553, 16553, 16553, 16553, 3728, 2034, 2034, 2034, 3696, 16553, 14472, 4130, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 14343, 16520, 14472, 12423, 10342, 8260, 0, 0, 0, 0, 0, 0, 0, 4130, 8293, 12390, 10341, 8260, 6212, 6211, 6180, 6179, 6211, 6211, 6179, 2049, 0, 0, 0, 4131, 12390, 16553, 14827, 3857, 2034, 2034, 3696, 16553, 16553, 8261, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
};

MatrixPanel_I2S_DMA* dma_display;
WebSocketsServer webSocket(80);

void onWebSocketEvent(uint8_t client_num, WStype_t type, uint8_t* payload, size_t length) {
  switch (type) {
    case WStype_DISCONNECTED:
      Serial.printf("[%u] Disconnected!\n", client_num);
      break;

    case WStype_CONNECTED:
      {
        IPAddress ip = webSocket.remoteIP(client_num);
        Serial.printf("[%u] Connected from %d.%d.%d.%d url: %s\n", client_num, ip[0], ip[1], ip[2], ip[3], payload);

        // Send a welcome message to the connected client
        webSocket.sendTXT(client_num, "Connected to ESP32 WebSocket server");
      }
      break;

    case WStype_BIN:
      {
          uint16_t* uint16_data = reinterpret_cast<uint16_t*>(payload);
          dma_display->drawRGBBitmap(0, 0, uint16_data, 128, 32);

          break;
      }  

    case WStype_TEXT:
      {
        // Parse and handle pixel data here
        Serial.printf("[%u] Received text: %s\n", client_num, payload);
      }
      break;
  }
}

void setup() {
  Serial.begin(115200);

  HUB75_I2S_CFG mxconfig;
  mxconfig.mx_height = PANEL_HEIGHT;      // we have 64 pix heigh panels
  mxconfig.chain_length = PANELS_NUMBER;  // we have 2 panels chained
  mxconfig.gpio.e = PIN_E;                // we MUST assign pin e to some free pin on a board to drive 64 pix height panels with 1/32 scan

  dma_display = new MatrixPanel_I2S_DMA(mxconfig);

  // let's adjust default brightness to about 75%
  dma_display->setBrightness8(190);  // range is 0-255, 0 - 0%, 255 - 100%

  // Allocate memory and start DMA display
  if (not dma_display->begin())
    Serial.println("****** !KABOOM! I2S memory allocation failed ***********");

  // Write some text
  dma_display->fillScreenRGB888(255, 0, 0);
  dma_display->setTextSize(1);     // size 1 == 8 pixels high
  dma_display->setTextWrap(true);  // Don't wrap at end of line - will do ourselves
  dma_display->print("connecting...");
  delay(1000);

  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(1000);
    Serial.print(".");
  }

  // Serial.print("IP: " + WiFi.localIP());

  dma_display->fillScreenRGB888(0, 0, 255);
  dma_display->setTextSize(1);     // size 1 == 8 pixels high
  dma_display->setTextWrap(true);  // Don't wrap at end of line - will do ourselves
  dma_display->setCursor(0,0);
  dma_display->print(WiFi.localIP());
  delay(2000);

  dma_display->drawRGBBitmap(0, 0, testData, 128, 32);

  webSocket.begin();
  webSocket.onEvent(onWebSocketEvent);
}

void loop() {
  webSocket.loop();
}
